<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Preconnect for Performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">

    <!-- Primary Meta Tags -->
    <title>AI Prompt Studio - 41+ Free Social Media Prompt Templates | ChatGPT, Claude & More</title>
    <meta name="title" content="AI Prompt Studio - 41+ Free Social Media Prompt Templates | ChatGPT, Claude & More">
    <meta name="description" content="Create professional AI prompts instantly with 41+ expert-designed templates for Facebook, Instagram, LinkedIn, Twitter, TikTok, Pinterest & YouTube. Free AI prompt generator for ChatGPT, Claude AI & Perplexity.">
    <meta name="keywords" content="AI prompt templates, ChatGPT prompts, Claude AI prompts, social media prompts, Instagram prompts, Facebook marketing prompts, LinkedIn content generator, TikTok video ideas, YouTube script generator, Twitter thread creator, Pinterest pin generator, AI content creation, prompt engineering, free AI tools">
    <meta name="author" content="Prompt Studio">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://txrba-2025.3rdrockads.com/templates.html">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://txrba-2025.3rdrockads.com/templates.html">
    <meta property="og:title" content="AI Prompt Studio - 41+ Free Social Media Prompt Templates">
    <meta property="og:description" content="Create professional AI prompts instantly with expert-designed templates for all major social media platforms. Works with ChatGPT, Claude AI & Perplexity.">
    <meta property="og:image" content="https://txrba-2025.3rdrockads.com/images/prompt-studio-og.jpg">
    <meta property="og:site_name" content="Prompt Studio">
    <meta property="og:locale" content="en_US">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://txrba-2025.3rdrockads.com/templates.html">
    <meta name="twitter:title" content="AI Prompt Studio - 41+ Free Social Media Prompt Templates">
    <meta name="twitter:description" content="Create professional AI prompts instantly with expert-designed templates for all major social media platforms. Works with ChatGPT, Claude AI & Perplexity.">
    <meta name="twitter:image" content="https://txrba-2025.3rdrockads.com/images/prompt-studio-twitter.jpg">

    <!-- Additional SEO Meta Tags -->
    <meta name="language" content="English">
    <meta name="revisit-after" content="7 days">
    <meta name="distribution" content="global">
    <meta name="rating" content="general">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- Mobile Optimization -->
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Prompt Studio">
    <link rel="apple-touch-icon" href="/images/3rd-logo.jpeg">

    <link rel="icon" type="image/jpeg" href="/images/3rd-logo.jpeg">
    <link rel="stylesheet" href="css/styles.css">
    <script src="js/csrf-helper.js"></script>
    <script src="js/session-manager.js"></script>

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Home",
          "item": "https://txrba-2025.3rdrockads.com/"
        },
        {
          "@type": "ListItem",
          "position": 2,
          "name": "Prompt Studio",
          "item": "https://txrba-2025.3rdrockads.com/templates.html"
        }
      ]
    }
    </script>

    <style>
        /* Override navbar to use dark background */
        .navbar {
            background: #000B14 !important;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #ffffff;
            color: #2c3e50;
            min-height: 100vh;
        }

        .studio-wrapper {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem 1.5rem;
        }

        .studio-header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem 0;
        }

        .studio-title {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .studio-tagline {
            color: #6c757d;
            font-size: 1.1rem;
            font-weight: 300;
        }

        /* Search Bar - Featured at Top */
        .search-section {
            margin-bottom: 2rem;
        }

        .search-container {
            position: relative;
            max-width: 600px;
            margin: 0 auto;
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
            font-size: 1.2rem;
        }

        .search-input {
            width: 100%;
            padding: 1rem 1rem 1rem 3rem;
            background: #ffffff;
            border: 2px solid #e0e0e0;
            border-radius: 50px;
            color: #2c3e50;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
            background: #ffffff;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .search-input::placeholder {
            color: #6c757d;
        }

        .clear-search-btn {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            background: transparent;
            border: none;
            color: #71717a;
            font-size: 2rem;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .clear-search-btn:hover {
            background: #f8f9fa;
            color: #2c3e50;
        }

        .search-info {
            text-align: center;
            margin-top: 1rem;
            padding: 0.75rem;
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 8px;
            color: #2c3e50;
            font-size: 0.925rem;
        }

        /* Filter Section */
        .filter-section {
            margin-bottom: 2rem;
            text-align: center;
        }

        .filter-header {
            font-size: 0.875rem;
            font-weight: 600;
            color: #6c757d;
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .filter-buttons {
            display: flex;
            gap: 0.75rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 0.6rem 1.25rem;
            background: #ffffff;
            border: 1px solid #e0e0e0;
            border-radius: 20px;
            color: #2c3e50;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-btn:hover {
            background: #f8f9fa;
            border-color: rgba(102, 126, 234, 0.5);
            color: #2c3e50;
        }

        .filter-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: transparent;
            color: white;
            font-weight: 600;
        }

        /* Main Studio Layout - Side by Side */
        .studio-layout {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        /* Left Panel - Blueprint Selector */
        .blueprint-panel {
            background: #ffffff;
            border: 1px solid #e0e0e0;
            border-radius: 16px;
            padding: 1.5rem;
            height: fit-content;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .panel-header {
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #6c757d;
            margin-bottom: 1rem;
        }

        .selector-group {
            margin-bottom: 1.5rem;
        }

        .selector-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .selector-dropdown {
            width: 100%;
            padding: 0.75rem 1rem;
            background: #ffffff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            color: #2c3e50;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .selector-dropdown:hover {
            background: #f8f9fa;
            border-color: #c0c0c0;
        }

        .selector-dropdown:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .selector-dropdown option {
            background: #ffffff;
            color: #2c3e50;
        }

        .elite-badge {
            display: inline-block;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: #fff;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 700;
            margin-left: 0.5rem;
            letter-spacing: 0.05em;
        }

        /* Right Panel - Composer */
        .composer-panel {
            background: #ffffff;
            border: 1px solid #e0e0e0;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .blueprint-info {
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 12px;
            padding: 1rem 1.25rem;
            margin-bottom: 2rem;
            font-size: 0.925rem;
            color: #2c3e50;
            font-style: italic;
            line-height: 1.6;
        }

        .composer-section {
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-icon {
            font-size: 1.25rem;
        }

        /* Configuration Options */
        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .config-field {
            margin-bottom: 1.5rem;
        }

        .field-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .field-input,
        .field-textarea {
            width: 100%;
            padding: 0.875rem 1rem;
            background: #ffffff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            color: #2c3e50;
            font-size: 0.95rem;
            font-family: inherit;
            transition: all 0.2s ease;
        }

        .field-textarea {
            min-height: 120px;
            resize: vertical;
            font-family: 'Monaco', 'Courier New', monospace;
            line-height: 1.6;
        }

        .field-input:focus,
        .field-textarea:focus {
            outline: none;
            border-color: #667eea;
            background: #ffffff;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .field-input::placeholder,
        .field-textarea::placeholder {
            color: #6c757d;
        }

        /* Output Preview Section */
        .output-preview {
            background: #ffffff;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 1.5rem;
            min-height: 200px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.875rem;
            line-height: 1.7;
            color: #000000 !important;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .output-placeholder {
            color: #71717a;
            font-style: italic;
            text-align: center;
            padding: 2rem;
        }

        /* Action Buttons */
        .action-bar {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .btn-action {
            padding: 0.875rem 2rem;
            border: none;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-bookmark {
            background: rgba(245, 158, 11, 0.15);
            color: #fbbf24;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .btn-bookmark:hover {
            background: rgba(245, 158, 11, 0.25);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        /* Result Modal */
        .result-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .result-modal.active {
            display: flex;
        }

        .result-container {
            background: #ffffff;
            border: 1px solid #e0e0e0;
            border-radius: 20px;
            padding: 2.5rem;
            max-width: 900px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #e0e0e0;
        }

        .result-title {
            font-size: 1.5rem;
            font-weight: 600;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .close-modal {
            background: transparent;
            border: none;
            color: #a1a1aa;
            font-size: 2rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .close-modal:hover {
            background: #f3f4f6;
            color: #000000;
        }

        .generated-output {
            background: #ffffff;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.875rem;
            line-height: 1.7;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 400px;
            overflow-y: auto;
            color: #000000 !important;
        }

        /* AI Platform Buttons */
        .platform-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 0.875rem;
            margin-bottom: 1.5rem;
        }

        .platform-btn {
            padding: 0.875rem 1rem;
            border: none;
            border-radius: 10px;
            font-size: 0.925rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .platform-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
        }

        .platform-chatgpt {
            background: #10a37f;
            color: white;
        }

        .platform-claude {
            background: #d97757;
            color: white;
        }

        .platform-perplexity {
            background: #20808d;
            color: white;
        }

        .platform-copy {
            background: #4b5563;
            color: #ffffff;
            border: 1px solid #374151;
        }

        .platform-copy:hover {
            background: #374151;
        }

        .platform-copy.copied {
            background: #22c55e;
            color: white;
        }

        .platform-bookmark {
            background: rgba(245, 158, 11, 0.15);
            color: #fbbf24;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .platform-bookmark:hover {
            background: rgba(245, 158, 11, 0.25);
        }

        .platform-bookmark.saved {
            background: #22c55e;
            color: white;
        }

        .disclaimer {
            text-align: center;
            font-size: 0.825rem;
            color: #71717a;
            margin-top: 2rem;
            font-style: italic;
        }

        /* Mobile Responsive */
        @media (max-width: 1024px) {
            .studio-layout {
                grid-template-columns: 1fr;
            }

            .blueprint-panel {
                order: 1;
            }

            .composer-panel {
                order: 2;
            }
        }

        @media (max-width: 768px) {
            .studio-wrapper {
                padding: 1rem;
            }

            .studio-title {
                font-size: 2rem;
            }

            .studio-tagline {
                font-size: 1rem;
            }

            .config-grid {
                grid-template-columns: 1fr;
            }

            .platform-grid {
                grid-template-columns: 1fr;
            }

            .action-bar {
                flex-direction: column;
            }

            .btn-action {
                width: 100%;
                justify-content: center;
            }

            .result-container {
                padding: 1.5rem;
                max-height: 90vh;
            }

            .field-input,
            .field-textarea,
            .selector-dropdown,
            .search-input {
                font-size: 16px; /* Prevent zoom on iOS */
            }
        }

        @media (max-width: 480px) {
            .studio-wrapper {
                padding: 0.75rem;
            }

            .studio-header {
                margin-bottom: 2rem;
                padding: 1rem 0;
            }

            .composer-panel {
                padding: 1.25rem;
            }

            .blueprint-panel {
                padding: 1.25rem;
            }
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Breadcrumb Navigation */
        .breadcrumb {
            padding: 1rem 2rem;
            background: #000B14;
            font-size: 0.9rem;
        }

        .breadcrumb-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .breadcrumb a {
            color: #9ca3af;
            text-decoration: none;
            transition: color 0.2s;
        }

        .breadcrumb a:hover {
            color: #667eea;
        }

        .breadcrumb-separator {
            margin: 0 0.5rem;
            color: #6b7280;
        }

        .breadcrumb-current {
            color: #f3f4f6;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="logo">
                <div class="logo-circle">
                    <img src="images/3rd-logo.jpeg" alt="3rd Rock Ads - AI Prompt Templates Logo">
                </div>
            </a>
            <ul class="nav-menu" id="navMenu">
                <li><a href="index.html">Home</a></li>
                <li><a href="templates.html" class="active">Prompt Studio</a></li>
                <li id="authLinks">
                    <a href="login.html">Login</a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- Breadcrumb Navigation -->
    <nav class="breadcrumb" aria-label="Breadcrumb">
        <div class="breadcrumb-container">
            <a href="/">Home</a>
            <span class="breadcrumb-separator">/</span>
            <span class="breadcrumb-current">Prompt Studio</span>
        </div>
    </nav>

    <div class="studio-wrapper">
        <!-- Header -->
        <div class="studio-header">
            <h1 class="studio-title">Prompt Studio</h1>
            <p class="studio-tagline">Craft professional AI prompts with expert-designed blueprints</p>
        </div>

        <!-- Search Section -->
        <div class="search-section">
            <div class="search-container">
                <span class="search-icon">üîç</span>
                <input type="text"
                       id="searchInput"
                       class="search-input"
                       placeholder="Search blueprints by keyword or topic...">
                <button class="clear-search-btn" id="clearSearchBtn" style="display: none;" title="Clear search">√ó</button>
            </div>
            <div class="search-info" id="searchInfo" style="display: none;"></div>
        </div>

        <!-- Category Filter Buttons -->
        <div class="filter-section" id="filterSection">
            <div class="filter-header">Quick Filters:</div>
            <div class="filter-buttons" id="filterButtons">
                <button class="filter-btn active" data-category="all">All Templates</button>
            </div>
        </div>

        <!-- Main Studio Layout -->
        <div class="studio-layout">
            <!-- Left Panel: Blueprint Selector -->
            <div class="blueprint-panel">
                <div class="panel-header">Blueprint Library</div>

                <div class="selector-group">
                    <label class="selector-label">Domain</label>
                    <select id="category" class="selector-dropdown">
                        <option value="">Loading domains...</option>
                    </select>
                </div>

                <div class="selector-group">
                    <label class="selector-label">Specialty</label>
                    <select id="subcategory" class="selector-dropdown">
                        <option value="">Choose a specialty...</option>
                    </select>
                </div>

                <div class="selector-group">
                    <label class="selector-label">Blueprint</label>
                    <select id="template" class="selector-dropdown">
                        <option value="">Choose a blueprint...</option>
                    </select>
                </div>
            </div>

            <!-- Right Panel: Composer -->
            <div class="composer-panel">
                <div id="blueprintInfo" class="blueprint-info" style="display: none;">
                    <div id="description"></div>
                </div>

                <!-- Configuration Options -->
                <div class="composer-section">
                    <div class="section-title">
                        <span class="section-icon">‚öôÔ∏è</span>
                        Output Configuration
                    </div>
                    <div class="config-grid">
                        <div>
                            <label class="field-label">Output Language</label>
                            <select id="language" class="selector-dropdown">
                                <option value="English">English</option>
                                <option value="Spanish">Spanish</option>
                                <option value="French">French</option>
                                <option value="German">German</option>
                                <option value="Italian">Italian</option>
                                <option value="Portuguese">Portuguese</option>
                                <option value="Chinese">Chinese</option>
                                <option value="Japanese">Japanese</option>
                                <option value="Korean">Korean</option>
                                <option value="Arabic">Arabic</option>
                                <option value="Hindi">Hindi</option>
                                <option value="Russian">Russian</option>
                            </select>
                        </div>
                        <div>
                            <label class="field-label">Tone Profile</label>
                            <select id="voiceTone" class="selector-dropdown">
                                <option value="Default">Default</option>
                                <option value="Authoritative">Authoritative</option>
                                <option value="Caring">Caring</option>
                                <option value="Casual">Casual</option>
                                <option value="Cheerful">Cheerful</option>
                                <option value="Conversational">Conversational</option>
                                <option value="Creative">Creative</option>
                                <option value="Enthusiastic">Enthusiastic</option>
                                <option value="Formal">Formal</option>
                                <option value="Friendly">Friendly</option>
                                <option value="Professional">Professional</option>
                                <option value="Witty">Witty</option>
                            </select>
                        </div>
                        <div>
                            <label class="field-label">Composition Style</label>
                            <select id="writingStyle" class="selector-dropdown">
                                <option value="Default">Default</option>
                                <option value="Academic">Academic</option>
                                <option value="Analytical">Analytical</option>
                                <option value="Conversational">Conversational</option>
                                <option value="Creative">Creative</option>
                                <option value="Descriptive">Descriptive</option>
                                <option value="Informative">Informative</option>
                                <option value="Persuasive">Persuasive</option>
                                <option value="Technical">Technical</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Dynamic Parameters -->
                <div id="dynamicParameters" class="composer-section" style="display: none;">
                    <div class="section-title">
                        <span class="section-icon">üìù</span>
                        Blueprint Parameters
                    </div>
                    <div id="dynamicInputs"></div>
                </div>

                <!-- Output Preview -->
                <div class="composer-section">
                    <div class="section-title">
                        <span class="section-icon">üëÅÔ∏è</span>
                        Prompt Preview
                    </div>
                    <div class="output-preview" id="promptTemplate">
                        <div class="output-placeholder">
                            Select a blueprint to preview the prompt structure...
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="action-bar">
                    <button class="btn-action btn-bookmark" id="saveBtn" style="display: none;">
                        <span>‚≠ê</span>
                        <span id="saveBtnText">Bookmark</span>
                    </button>
                    <button class="btn-action btn-primary" id="executeBtn">
                        <span>‚ú®</span>
                        <span>Generate Prompt</span>
                    </button>
                </div>

                <div class="disclaimer">
                    AI systems may produce inaccurate results. Always verify generated content for accuracy.
                </div>
            </div>
        </div>
    </div>

    <!-- Result Modal -->
    <div class="result-modal" id="promptModal">
        <div class="result-container">
            <div class="result-header">
                <h2 class="result-title">Your Generated Prompt</h2>
                <button class="close-modal" id="closeModalBtn">√ó</button>
            </div>

            <div class="generated-output" id="generatedPrompt"></div>

            <!-- Project Selection for Save (only shown for logged-in users) -->
            <div id="projectSelectionSection" style="display: none; margin-bottom: 1.5rem;">
                <label class="field-label" style="color: #374151; margin-bottom: 0.5rem; display: block;">
                    üìÅ Save to Project (Optional)
                </label>
                <select id="projectDropdown" class="selector-dropdown">
                    <option value="">No Project</option>
                </select>
            </div>

            <div class="platform-grid">
                <button class="platform-btn platform-chatgpt" data-ai="chatgpt">
                    <span>ü§ñ</span>
                    <span>ChatGPT</span>
                </button>
                <button class="platform-btn platform-claude" data-ai="claude">
                    <span>üß†</span>
                    <span>Claude</span>
                </button>
                <button class="platform-btn platform-perplexity" data-ai="perplexity">
                    <span>üîç</span>
                    <span>Perplexity</span>
                </button>
                <button class="platform-btn platform-copy" id="copyBtn">
                    <span>üìã</span>
                    <span id="copyBtnText">Copy</span>
                </button>
                <button class="platform-btn platform-copy" id="downloadBtn">
                    <span>üíæ</span>
                    <span>Export</span>
                </button>
                <button class="platform-btn platform-bookmark" id="savePromptBtn" style="display: none;">
                    <span>‚≠ê</span>
                    <span id="savePromptBtnText">Save Prompt</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        let generatedPromptText = '';
        let allTemplates = {};
        let templates = {};
        let currentFilter = 'all';
        let searchQuery = '';

        // Authentication Check
        function checkAuth() {
            const token = localStorage.getItem('authToken');
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            const navMenu = document.getElementById('navMenu');

            // Debug logging
            console.log('Auth check:', { hasToken: !!token, user: user, username: user.username });

            if (token && user.name) {
                // User is logged in - show full menu with username and tokens
                const tokens = user.tokens !== undefined ? user.tokens : '...';
                navMenu.innerHTML = `
                    <li><a href="index.html">Home</a></li>
                    <li><a href="templates.html" class="active">Prompt Studio</a></li>
                    <li><a href="/dashboard">My Vault</a></li>
                    <li id="adminMenuLink" style="display: none;"><a href="/admin/users">User Management</a></li>
                    <li style="color: #a1a1aa; display: flex; align-items: center; padding: 0 1rem;">Welcome, ${user.name} | ü™ô ${tokens} tokens</li>
                    <li><a href="#" id="logoutBtn" class="btn-primary">Logout</a></li>
                `;

                // Show admin menu if user is admin
                if (user.is_admin) {
                    document.getElementById('adminMenuLink').style.display = 'list-item';
                }

                // Add logout handler
                setTimeout(() => {
                    const logoutBtn = document.getElementById('logoutBtn');
                    if (logoutBtn) {
                        logoutBtn.addEventListener('click', function(e) {
                            e.preventDefault();
                            logout();
                        });
                    }
                }, 0);
            } else {
                // User is not logged in
                navMenu.innerHTML = `
                    <li><a href="index.html">Home</a></li>
                    <li><a href="templates.html" class="active">Prompt Studio</a></li>
                    <li><a href="login.html">Login</a></li>
                    <li><a href="register.html" class="btn-primary">Sign Up</a></li>
                `;
            }
        }

        function logout() {
            localStorage.removeItem('authToken');
            localStorage.removeItem('user');
            window.location.href = 'login.html';
        }

        checkAuth();

        // Load Templates from API
        async function loadTemplates() {
            try {
                const response = await fetch('/api/templates');

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                allTemplates = await response.json();
                console.log('Loaded templates:', allTemplates);

                if (!allTemplates || typeof allTemplates !== 'object') {
                    throw new Error('Invalid template data received');
                }

                for (const [category, subcategories] of Object.entries(allTemplates)) {
                    for (const [subcategory, templateList] of Object.entries(subcategories)) {
                        if (!templates[subcategory]) {
                            templates[subcategory] = {};
                        }
                        templateList.forEach(template => {
                            templates[subcategory][template.name] = {
                                description: template.description,
                                inputs: template.inputs,
                                prompt: template.prompt_template,
                                premium: template.is_premium,
                                id: template.id
                            };
                        });
                    }
                }

                populateCategories();
                populateFilterButtons();
            } catch (error) {
                console.error('Error loading templates:', error);
                const categorySelect = document.getElementById('category');
                categorySelect.innerHTML = '<option value="">Error loading domains</option>';
                alert('Failed to load blueprints. Please refresh the page.');
            }
        }

        // Populate filter buttons based on categories
        function populateFilterButtons() {
            const filterButtons = document.getElementById('filterButtons');
            filterButtons.innerHTML = '<button class="filter-btn active" data-category="all">All Templates</button>';

            Object.keys(allTemplates).forEach(category => {
                const button = document.createElement('button');
                button.className = 'filter-btn';
                button.setAttribute('data-category', category);
                button.textContent = category;
                button.addEventListener('click', function() {
                    handleFilterClick(category);
                });
                filterButtons.appendChild(button);
            });
        }

        // Handle filter button click
        function handleFilterClick(category) {
            currentFilter = category;

            // Update active button
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-category') === category) {
                    btn.classList.add('active');
                }
            });

            // Apply filter
            if (category === 'all') {
                populateCategories();
            } else {
                categorySelect.value = category;
                loadSubcategories(category);
            }

            // Clear search
            searchInput.value = '';
            searchQuery = '';
            document.getElementById('clearSearchBtn').style.display = 'none';
            document.getElementById('searchInfo').style.display = 'none';

            templateSelect.innerHTML = '<option value="">Choose a blueprint...</option>';
            resetComposer();
        }

        function populateCategories() {
            const categorySelect = document.getElementById('category');
            const subcategorySelect = document.getElementById('subcategory');

            categorySelect.innerHTML = '';
            subcategorySelect.innerHTML = '<option value="">Choose a specialty...</option>';

            if (!allTemplates || Object.keys(allTemplates).length === 0) {
                categorySelect.innerHTML = '<option value="">No domains available</option>';
                console.error('No templates loaded');
                return;
            }

            Object.keys(allTemplates).forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categorySelect.appendChild(option);
            });

            if (Object.keys(allTemplates).length > 0) {
                const firstCategory = Object.keys(allTemplates)[0];
                categorySelect.value = firstCategory;
                loadSubcategories(firstCategory);
            }
        }

        function loadSubcategories(category) {
            const subcategorySelect = document.getElementById('subcategory');
            subcategorySelect.innerHTML = '<option value="">Choose a specialty...</option>';

            if (allTemplates[category]) {
                Object.keys(allTemplates[category]).forEach(subcategory => {
                    const option = document.createElement('option');
                    option.value = subcategory;
                    option.textContent = subcategory;
                    subcategorySelect.appendChild(option);
                });
            }
        }

        // DOM Elements
        const categorySelect = document.getElementById('category');
        const subcategorySelect = document.getElementById('subcategory');
        const templateSelect = document.getElementById('template');
        const searchInput = document.getElementById('searchInput');
        const descriptionDiv = document.getElementById('description');
        const dynamicInputsDiv = document.getElementById('dynamicInputs');
        const promptTemplateDiv = document.getElementById('promptTemplate');
        const blueprintInfo = document.getElementById('blueprintInfo');
        const dynamicParameters = document.getElementById('dynamicParameters');

        // Category change listener
        categorySelect.addEventListener('change', function() {
            loadSubcategories(this.value);
            templateSelect.innerHTML = '<option value="">Choose a blueprint...</option>';
            resetComposer();
        });

        // Subcategory change listener
        subcategorySelect.addEventListener('change', function() {
            const subcategory = this.value;
            templateSelect.innerHTML = '<option value="">Choose a blueprint...</option>';
            resetComposer();

            if (subcategory && templates[subcategory]) {
                Object.keys(templates[subcategory]).forEach(templateName => {
                    const option = document.createElement('option');
                    option.value = templateName;
                    option.textContent = templateName;
                    templateSelect.appendChild(option);
                });
            }
        });

        // Template change listener
        templateSelect.addEventListener('change', function() {
            const subcategory = subcategorySelect.value;
            const templateName = this.value;

            if (subcategory && templateName && templates[subcategory][templateName]) {
                const template = templates[subcategory][templateName];

                // Show description
                let desc = template.description;
                if (template.premium) {
                    desc += ' <span class="elite-badge">ELITE</span>';
                }
                descriptionDiv.innerHTML = desc;
                blueprintInfo.style.display = 'block';

                // Generate dynamic inputs
                dynamicInputsDiv.innerHTML = '';
                if (template.inputs && template.inputs.length > 0) {
                    dynamicParameters.style.display = 'block';
                    template.inputs.forEach(input => {
                        const field = document.createElement('div');
                        field.className = 'config-field';

                        const label = document.createElement('label');
                        label.className = 'field-label';
                        label.textContent = input.label;

                        let inputElement;
                        if (input.type === 'textarea') {
                            inputElement = document.createElement('textarea');
                            inputElement.className = 'field-textarea';
                            inputElement.placeholder = input.label;
                        } else if (input.type === 'number') {
                            inputElement = document.createElement('input');
                            inputElement.type = 'number';
                            inputElement.className = 'field-input';
                            inputElement.placeholder = input.placeholder || input.label;
                            inputElement.value = input.default || input.value || '';
                        } else {
                            inputElement = document.createElement('input');
                            inputElement.type = 'text';
                            inputElement.className = 'field-input';
                            inputElement.placeholder = input.label;
                            if (input.value) {
                                inputElement.value = input.value;
                            }
                        }
                        inputElement.id = `input-${input.name}`;
                        inputElement.setAttribute('data-name', input.name);

                        field.appendChild(label);
                        field.appendChild(inputElement);
                        dynamicInputsDiv.appendChild(field);
                    });
                } else {
                    dynamicParameters.style.display = 'none';
                }

                // Set prompt preview
                promptTemplateDiv.textContent = template.prompt;
                promptTemplateDiv.style.color = '#e4e4e7';

                // Show/update bookmark button
                updateBookmarkButton(template.id, template.isSaved);
            } else {
                resetComposer();
            }
        });

        function resetComposer() {
            descriptionDiv.textContent = '';
            blueprintInfo.style.display = 'none';
            dynamicInputsDiv.innerHTML = '';
            dynamicParameters.style.display = 'none';
            promptTemplateDiv.innerHTML = '<div class="output-placeholder">Select a blueprint to preview the prompt structure...</div>';
            document.getElementById('saveBtn').style.display = 'none';
        }

        // Search functionality
        searchInput.addEventListener('input', async function() {
            const query = this.value.trim();
            searchQuery = query;

            const clearBtn = document.getElementById('clearSearchBtn');
            const searchInfo = document.getElementById('searchInfo');

            // Show/hide clear button
            clearBtn.style.display = query ? 'flex' : 'none';

            if (query.length < 2) {
                searchInfo.style.display = 'none';
                if (currentFilter === 'all') {
                    populateCategories();
                } else {
                    categorySelect.value = currentFilter;
                    loadSubcategories(currentFilter);
                }
                templateSelect.innerHTML = '<option value="">Choose a blueprint...</option>';
                return;
            }

            try {
                const response = await fetch(`/api/templates/search?q=${encodeURIComponent(query)}`);
                const results = await response.json();

                // Show search info
                searchInfo.style.display = 'block';
                searchInfo.textContent = `Found ${results.length} blueprint${results.length !== 1 ? 's' : ''} matching "${query}"`;

                if (results.length === 0) {
                    templateSelect.innerHTML = '<option value="">No blueprints found</option>';
                    return;
                }

                templateSelect.innerHTML = '<option value="">Select from search results...</option>';

                results.forEach(template => {
                    const option = document.createElement('option');
                    option.value = template.name;
                    option.textContent = `${template.name} (${template.category} - ${template.subcategory})`;
                    option.setAttribute('data-subcategory', template.subcategory);
                    option.setAttribute('data-category', template.category);
                    templateSelect.appendChild(option);

                    if (!templates[template.subcategory]) {
                        templates[template.subcategory] = {};
                    }
                    templates[template.subcategory][template.name] = {
                        description: template.description,
                        inputs: template.inputs,
                        prompt: template.prompt_template,
                        premium: template.is_premium,
                        id: template.id
                    };
                });

                if (results.length > 0) {
                    categorySelect.value = results[0].category;
                    loadSubcategories(results[0].category);
                    subcategorySelect.value = results[0].subcategory;
                }
            } catch (error) {
                console.error('Search error:', error);
                searchInfo.style.display = 'block';
                searchInfo.textContent = 'Search failed. Please try again.';
                searchInfo.style.background = 'rgba(239, 68, 68, 0.1)';
                searchInfo.style.borderColor = 'rgba(239, 68, 68, 0.3)';
            }
        });

        // Clear search button
        document.getElementById('clearSearchBtn').addEventListener('click', function() {
            searchInput.value = '';
            searchQuery = '';
            this.style.display = 'none';
            document.getElementById('searchInfo').style.display = 'none';

            // Reset to current filter or all
            if (currentFilter === 'all') {
                populateCategories();
            } else {
                categorySelect.value = currentFilter;
                loadSubcategories(currentFilter);
            }
            templateSelect.innerHTML = '<option value="">Choose a blueprint...</option>';
            resetComposer();
        });

        // Add "All Templates" filter button listener
        document.querySelector('.filter-btn[data-category="all"]').addEventListener('click', function() {
            handleFilterClick('all');
        });

        // Bookmark functionality
        function updateBookmarkButton(templateId, isSaved) {
            const token = localStorage.getItem('authToken');
            const saveBtn = document.getElementById('saveBtn');
            const saveBtnText = document.getElementById('saveBtnText');

            if (!token) {
                saveBtn.style.display = 'none';
                return;
            }

            saveBtn.style.display = 'flex';
            saveBtnText.textContent = isSaved ? 'Bookmarked' : 'Bookmark';
            saveBtn.setAttribute('data-template-id', templateId);
            saveBtn.setAttribute('data-is-saved', isSaved ? 'true' : 'false');
        }

        async function toggleSaveTemplate() {
            const saveBtn = document.getElementById('saveBtn');
            const saveBtnText = document.getElementById('saveBtnText');
            const templateId = saveBtn.getAttribute('data-template-id');
            const isSaved = saveBtn.getAttribute('data-is-saved') === 'true';
            const token = localStorage.getItem('authToken');

            if (!token || !templateId) {
                alert('Please log in to bookmark blueprints');
                return;
            }

            try {
                const method = isSaved ? 'DELETE' : 'POST';
                const response = await fetch(`/api/templates/${templateId}/save`, {
                    method: method,
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    credentials: 'include'
                });

                if (response.ok) {
                    const newIsSaved = !isSaved;
                    updateBookmarkButton(templateId, newIsSaved);

                    const subcategory = subcategorySelect.value;
                    const templateName = templateSelect.value;
                    if (templates[subcategory][templateName]) {
                        templates[subcategory][templateName].isSaved = newIsSaved;
                    }

                    saveBtnText.textContent = newIsSaved ? 'Bookmarked!' : 'Removed';
                    setTimeout(() => {
                        updateBookmarkButton(templateId, newIsSaved);
                    }, 1000);
                } else {
                    alert('Failed to bookmark. Please try again.');
                }
            } catch (error) {
                console.error('Error bookmarking:', error);
                alert('Failed to bookmark. Please try again.');
            }
        }

        // Load projects for save dropdown
        async function loadProjectsForSave() {
            const token = localStorage.getItem('authToken');
            if (!token) return;

            try {
                const response = await fetch('/api/projects', {
                    credentials: 'include'
                });

                if (response.ok) {
                    const data = await response.json();
                    const projectDropdown = document.getElementById('projectDropdown');

                    // Clear existing options except "No Project"
                    projectDropdown.innerHTML = '<option value="">No Project</option>';

                    // Add user's projects
                    data.projects.forEach(project => {
                        const option = document.createElement('option');
                        option.value = project.id;
                        option.textContent = project.name;
                        projectDropdown.appendChild(option);
                    });

                    // Show the project selection section
                    document.getElementById('projectSelectionSection').style.display = 'block';
                }
            } catch (error) {
                console.error('Error loading projects:', error);
            }
        }

        // Generate Prompt
        async function executeTemplate() {
            const subcategory = subcategorySelect.value;
            const templateName = templateSelect.value;
            const category = categorySelect.value;

            if (!subcategory) {
                alert('‚ö†Ô∏è Please select a specialty first.');
                return;
            }

            if (!templateName) {
                alert('‚ö†Ô∏è Please select a blueprint first.');
                return;
            }

            const template = templates[subcategory][templateName];
            if (!template) {
                alert('‚ö†Ô∏è Blueprint not found.');
                return;
            }

            // Validate that all input fields are filled
            const inputs = dynamicInputsDiv.querySelectorAll('input, textarea');
            let hasEmptyFields = false;
            let emptyFieldLabels = [];

            inputs.forEach(input => {
                const value = input.value.trim();
                if (!value) {
                    hasEmptyFields = true;
                    // Try to get label from the previous sibling or use placeholder
                    const fieldDiv = input.parentElement;
                    const labelElement = fieldDiv.querySelector('.field-label');
                    const fieldName = labelElement ? labelElement.textContent : (input.placeholder || input.getAttribute('data-name') || 'Unknown field');
                    emptyFieldLabels.push(fieldName);
                }
            });

            if (hasEmptyFields) {
                alert(`‚ö†Ô∏è Please fill in all blueprint parameters:\n\n${emptyFieldLabels.join('\n')}`);
                return;
            }

            // Check if user is logged in for token deduction
            const token = localStorage.getItem('authToken');
            if (token) {
                // Determine token cost (1 for normal, 5 for premium)
                const tokenCost = template.premium ? 5 : 1;

                try {
                    // Call token deduction endpoint
                    const tokenResponse = await fetchWithCsrf('/api/generate-prompt', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        credentials: 'include',
                        body: JSON.stringify({
                            isPremium: template.premium || false,
                            templateName: templateName
                        })
                    });

                    if (!tokenResponse.ok) {
                        const errorData = await tokenResponse.json();
                        if (tokenResponse.status === 402) {
                            // Insufficient tokens
                            alert(`‚ö†Ô∏è Insufficient tokens!\n\n${errorData.message}\n\nYou have ${errorData.tokensAvailable} token(s) but need ${errorData.tokensRequired} token(s) to generate this prompt.`);
                            return;
                        } else {
                            alert(`‚ö†Ô∏è Error: ${errorData.message || 'Failed to process token deduction'}`);
                            return;
                        }
                    }

                    // Successfully deducted tokens - update user's token count in localStorage
                    const tokenData = await tokenResponse.json();
                    const user = JSON.parse(localStorage.getItem('user') || '{}');
                    user.tokens = tokenData.remainingTokens;
                    localStorage.setItem('user', JSON.stringify(user));

                    // Update token display in navigation
                    checkAuth();
                } catch (error) {
                    console.error('Token deduction error:', error);
                    alert('‚ö†Ô∏è Failed to process token deduction. Please try again.');
                    return;
                }
            }

            let finalPrompt = template.prompt;

            // Replace placeholders (all fields are validated to be filled at this point)
            // Reuse the inputs already queried above for validation
            inputs.forEach(input => {
                const name = input.getAttribute('data-name');
                const value = input.value.trim();
                const placeholder = `{{${name}}}`;
                finalPrompt = finalPrompt.replaceAll(placeholder, value);
            });

            // Apply global configuration options (language, tone, writing style)
            const language = document.getElementById('language').value;
            const voiceTone = document.getElementById('voiceTone').value;
            const writingStyle = document.getElementById('writingStyle').value;

            // Replace language references
            finalPrompt = finalPrompt.replace(/respond only in the (\w+) language/gi, `respond only in the ${language} language`);

            // Replace tone of voice (handle various phrasings)
            if (voiceTone && voiceTone !== 'Default') {
                finalPrompt = finalPrompt.replace(/You have a \w+ tone of voice\./gi, `You have a ${voiceTone} tone of voice.`);
            }

            // Replace writing style (handle various phrasings)
            if (writingStyle && writingStyle !== 'Default') {
                finalPrompt = finalPrompt.replace(/You have a \w+ writing style\./gi, `You have a ${writingStyle} writing style.`);
            }

            // Track usage
            if (token && template.id) {
                try {
                    await fetch('/api/usage', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        credentials: 'include',
                        body: JSON.stringify({
                            templateName: templateName,
                            category: category
                        })
                    });
                } catch (error) {
                    console.error('Failed to track usage:', error);
                }
            }

            // Show modal
            generatedPromptText = finalPrompt;
            document.getElementById('generatedPrompt').textContent = finalPrompt;
            document.getElementById('promptModal').classList.add('active');

            // Load projects for save dropdown if user is logged in
            if (token) {
                await loadProjectsForSave();
            }

            // Reset copy button
            const copyBtn = document.getElementById('copyBtn');
            copyBtn.classList.remove('copied');
            document.getElementById('copyBtnText').textContent = 'Copy';

            // Show/hide save prompt button
            const savePromptBtn = document.getElementById('savePromptBtn');
            const savePromptBtnText = document.getElementById('savePromptBtnText');
            if (token) {
                savePromptBtn.style.display = 'flex';
                savePromptBtn.classList.remove('saved');
                savePromptBtnText.textContent = 'Save Prompt';
            } else {
                savePromptBtn.style.display = 'none';
            }
        }

        function closeModal() {
            document.getElementById('promptModal').classList.remove('active');
        }

        function copyToClipboard() {
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(generatedPromptText).then(() => {
                    const copyBtn = document.getElementById('copyBtn');
                    const copyBtnText = document.getElementById('copyBtnText');
                    copyBtn.classList.add('copied');
                    copyBtnText.textContent = '‚úì Copied';

                    setTimeout(() => {
                        copyBtn.classList.remove('copied');
                        copyBtnText.textContent = 'Copy';
                    }, 2000);
                }).catch(err => {
                    console.error('Clipboard error:', err);
                    alert('Failed to copy. Please copy manually.');
                });
            } else {
                const textArea = document.createElement('textarea');
                textArea.value = generatedPromptText;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    const copyBtn = document.getElementById('copyBtn');
                    const copyBtnText = document.getElementById('copyBtnText');
                    copyBtn.classList.add('copied');
                    copyBtnText.textContent = '‚úì Copied';

                    setTimeout(() => {
                        copyBtn.classList.remove('copied');
                        copyBtnText.textContent = 'Copy';
                    }, 2000);
                } catch (err) {
                    alert('Failed to copy. Please copy manually.');
                }
                document.body.removeChild(textArea);
            }
        }

        function downloadPrompt() {
            const templateName = templateSelect.value || 'prompt';
            const timestamp = new Date().toISOString().split('T')[0];
            const filename = `${templateName.replace(/[^a-z0-9]/gi, '_')}_${timestamp}.txt`;

            const blob = new Blob([generatedPromptText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        async function savePromptToAccount() {
            const token = localStorage.getItem('authToken');
            if (!token) {
                alert('Please log in to save prompts');
                return;
            }

            const templateName = templateSelect.value;
            const category = categorySelect.value;
            const subcategory = subcategorySelect.value;

            if (!templateName || !generatedPromptText) {
                alert('No prompt to save');
                return;
            }

            const savePromptBtn = document.getElementById('savePromptBtn');
            const savePromptBtnText = document.getElementById('savePromptBtnText');

            // Collect inputs
            const inputs = {};
            const inputElements = dynamicInputsDiv.querySelectorAll('input, textarea');
            inputElements.forEach(input => {
                const name = input.getAttribute('data-name');
                inputs[name] = input.value;
            });

            // Get selected project
            const projectDropdown = document.getElementById('projectDropdown');
            const projectId = projectDropdown.value || null;

            try {
                savePromptBtnText.textContent = 'Saving...';

                const response = await fetchWithCsrf('/api/prompts/save', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        templateName: templateName,
                        category: `${category} - ${subcategory}`,
                        promptText: generatedPromptText,
                        inputs: inputs,
                        projectId: projectId
                    })
                });

                if (response.ok) {
                    savePromptBtn.classList.add('saved');
                    savePromptBtnText.textContent = 'Saved!';
                    setTimeout(() => {
                        savePromptBtnText.textContent = 'Saved';
                    }, 1000);
                } else {
                    const error = await response.json();
                    alert(error.error || 'Failed to save prompt. Please try again.');
                    savePromptBtnText.textContent = 'Save Prompt';
                }
            } catch (error) {
                console.error('Error saving prompt:', error);
                alert('Failed to save prompt. Please try again.');
                savePromptBtnText.textContent = 'Save Prompt';
            }
        }

        function submitToAI(aiService) {
            const encodedPrompt = encodeURIComponent(generatedPromptText);
            let url = '';

            switch(aiService) {
                case 'chatgpt':
                    url = `https://chat.openai.com/?q=${encodedPrompt}`;
                    break;
                case 'claude':
                    url = `https://claude.ai/new?q=${encodedPrompt}`;
                    break;
                case 'perplexity':
                    url = `https://www.perplexity.ai/?q=${encodedPrompt}`;
                    break;
                default:
                    alert('Unknown platform');
                    return;
            }

            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(generatedPromptText);
            }

            window.open(url, '_blank');
        }

        // Event Listeners
        document.getElementById('executeBtn').addEventListener('click', executeTemplate);
        document.getElementById('saveBtn').addEventListener('click', toggleSaveTemplate);
        document.getElementById('closeModalBtn').addEventListener('click', closeModal);
        document.getElementById('copyBtn').addEventListener('click', copyToClipboard);
        document.getElementById('downloadBtn').addEventListener('click', downloadPrompt);
        document.getElementById('savePromptBtn').addEventListener('click', savePromptToAccount);

        document.querySelectorAll('.platform-btn[data-ai]').forEach(button => {
            button.addEventListener('click', function() {
                const aiService = this.getAttribute('data-ai');
                submitToAI(aiService);
            });
        });

        document.addEventListener('click', function(event) {
            const modal = document.getElementById('promptModal');
            if (event.target === modal) {
                closeModal();
            }
        });

        // Load templates on page load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                loadTemplates();
            });
        } else {
            // DOM already loaded
            loadTemplates();
        }
    </script>
    <script src="js/auth.js"></script>
    <script src="js/cart.js"></script>
</body>
</html>
